<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Cirdi - Assistant documentaire scientifique du CIRED</title>
  <link rel="stylesheet" href="https://unpkg.com/purecss@3.0.0/build/pure-min.css">
  <link rel="stylesheet" href="https://unpkg.com/purecss@3.0.0/build/grids-responsive-min.css">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.5/dist/purify.min.js"></script>
  <link rel="stylesheet" href="main.css">
</head>

<body>

<header>
  <button id="config-btn">⚙️</button>
  <button id="profile-btn">👤</button>
    <div id="input-container">
      <div id="input">
        <textarea
          id="user-input"
          placeholder="Cirdi, que disent les écrits du CIRED sur..."
          rows="2"
          ></textarea>
        <button id="send-btn">
          ➤
        </button>
      </div>
      <div id="input-help">
        <p>Cirdi parle français et + de 100 langues: Cirdi speaks English – Hablo español – Я говорю по-русски – 我会说中文 – أنا أتكلم العربية.</p>
        <p>Appuyez sur Entrée pour envoyer, Maj+Entrée pour une nouvelle ligne.</p>
      </div>
    </div> <!-- id="input-container" -->
</header>

<main id="messages-container">
  <div>
    <div id="greeting">
      Bonjour !<br /><br />
      Je suis <strong>Cirdi</strong>, votre documentaliste scientifique. Je dispose des travaux du Centre International de Recherche sur l'Environnement et le Développement (CIRED) sur les thèmes ci dessous. Je vais les analyser afin de vous proposer une synthèse avec liens directs en accès libre sur HAL pour en savoir plus 😉.<br />
      <div id="legend">
        <strong>Domaines d'expertise</strong> : Cirdi a indexé 1199 publications du CIRED
      </div>
      <img
        alt="Nuage de mots représentant les principales thématiques de recherche CIRED : changement climatique, transition énergétique, politique climatique, modélisation économique, énergies renouvelables, développement durable, et politiques environnementales"
        src="static/cired_wordcloud.png"
      />
    </div> <!-- id="greeting" -->
  </div> <!-- id="messages-container" -->
</main>

<footer>
    ⚠️ <strong>Les conversations sont enregistrées pour améliorer le service.</strong>
    Vous pourrez donner un feedback en cliquant 👍 ou 👎 sous la réponse.<br />
    📊 <a href="#" id="view-analytics-link">Voir les données collectées</a> |
    🔒 <a href="#" id="privacy-policy-link">Politique de confidentialité</a>
</footer>


<!-- Configuration Panel -->
<aside class="hidden" id="config-panel">

  <div id="config-header">
    <button id="config-close-btn">✖️</button>
    <h2>Cirdi settings</h2>
  </div>

  <div class="settings-grid" id="settings-container">

    <div class="form-group">
      <div class="label-with-status">
        <label class="form-label">
          Server URL
          <span class="help-icon" title="Where to find the R2R API endpoint. Try http://cired.digital:7272">ℹ️</span>
        </label>
        <div class="status-text" id="api-status">Status: OK</div>
      </div>
      <input class="form-input" id="api-url" type="text"/>
    </div>

    <div class="form-group">
      <label class="form-label">
      Language model
      <span class="help-icon" title="The LLM used to generate replies. Commercial options disabled for cost control.">ℹ️</span>
      </label>
      <select class="form-select" id="model">
        <option>Chargement...</option>
      </select>
      <div id="model-info">
        Tariff: input <span id="input-tariff">...</span>&nbsp;$, output <span id="output-tariff">...</span>&nbsp;$ per 1M tokens
      </div>
    </div>

    <div class="form-group">
      <label class="form-label">
        Temperature (response creativity)
        <span class="help-icon" title="Automatically set to model provider's recommendations.">ℹ️</span>
      </label>
      <input type="number" id="temperature" class="form-input" step="0.05"/>
    </div>

    <div class="form-group">
      <label class="form-label">
        Max tokens (response length)
        <span class="help-icon" title="Automatically set according to the model.">ℹ️</span>
      </label>
      <input type="number" id="max-tokens" class="form-input" step="100"/>
    </div>

    <div class="form-group">
      <label class="form-label">
        Nombre maximum de segments à récupérer
        <span class="help-icon" title="Entre 1 et 1000.">ℹ️</span>
      </label>
      <input type="number" id="chunk-limit" class="form-input" step="1"/>
    </div>

    <div class="form-group">
      <label class="form-label">
        Méthode pour pêcher les segments
        <span class="help-icon" title="Options: vanilla (recherche directe rapide - pour question précise), rag_fusion (reformule - pour question ambigüe), HyDE (prêche le faux pour pêcher le vrai - pour question ouverte, conceptuelle)">ℹ️</span>
      </label>
      <select id="search-strategy" class="form-select">
        <option value="vanilla">Vanilla</option>
        <option value="rag_fusion">RAG Fusion</option>
        <option value="hyde" selected>Hyde</option>
      </select>
    </div>

    <div class="checkbox-container web-search-container">
      <label class="checkbox-label">
        <input type="checkbox" id="include-web-search" class="checkbox-input"  disabled>
        <span class="web-search-text"><strong>Recherche Web</strong> – Inclure les résultats web (0.1 cent par question)</span>
      </label>
    </div>

    <div class="checkbox-container privacy-container">
      <label class="checkbox-label">
        <input type="checkbox" id="privacy-mode" class="checkbox-input">
        <span class="privacy-text"><strong>Privacy Mode</strong> – No logging</span>
      </label>
      <div class="form-group">
        <div class="label-with-status">
          <label class="form-label" for="feedback-url">URL du backend de journalisation</label>
          <div class="status-text" id="feedback-status">Chargement…</div>
        </div>
        <input class="form-input" id="feedback-url" type="text" readonly/>
      </div>
    </div>

    <div class="checkbox-container debug-container">
      <label class="checkbox-label">
        <input type="checkbox" id="debug-mode" class="checkbox-input">
        <span class="debug-text"><strong>Debug Mode</strong> – Show response logs in console</span>
      </label>
    </div>

  </div> <!-- id="settings-container"-->
</aside>

<!-- Onboarding Modal -->
<div id="onboarding-modal" class="modal-overlay hidden">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Bienvenue sur Cirdi !</h2>
      <p>Aidez-nous à mieux comprendre vos besoins en complétant ce profil rapide.</p>
    </div>
    
    <form id="profile-form" class="settings-grid">
      <div class="form-group">
        <label class="form-label" for="profile-name">Nom (optionnel)</label>
        <input type="text" id="profile-name" class="form-input" placeholder="Votre nom">
      </div>
      
      <div class="form-group">
        <label class="form-label" for="profile-email">Email (optionnel)</label>
        <input type="email" id="profile-email" class="form-input" placeholder="votre.email@exemple.com">
      </div>
      
      <div class="form-group">
        <label class="form-label" for="profile-role">Votre rôle</label>
        <select id="profile-role" class="form-select">
          <option value="">Sélectionnez votre rôle</option>
          <option value="researcher">Chercheur/Chercheuse</option>
          <option value="student">Étudiant(e)</option>
          <option value="policy-maker">Décideur politique</option>
          <option value="consultant">Consultant(e)</option>
          <option value="journalist">Journaliste</option>
          <option value="citizen">Citoyen(ne)</option>
          <option value="other">Autre</option>
        </select>
      </div>
      
      <div class="form-group">
        <label class="form-label" for="profile-usage">Contexte d'utilisation</label>
        <select id="profile-usage" class="form-select">
          <option value="">Sélectionnez le contexte</option>
          <option value="research">Recherche académique</option>
          <option value="education">Enseignement/Formation</option>
          <option value="policy">Élaboration de politiques</option>
          <option value="business">Conseil/Business</option>
          <option value="personal">Intérêt personnel</option>
          <option value="journalism">Journalisme</option>
          <option value="other">Autre</option>
        </select>
      </div>
      
      <div class="form-group">
        <label class="form-label" for="profile-organization">Type d'organisation</label>
        <select id="profile-organization" class="form-select">
          <option value="">Sélectionnez le type</option>
          <option value="university">Université/École</option>
          <option value="research-institute">Institut de recherche</option>
          <option value="government">Administration publique</option>
          <option value="ngo">ONG/Association</option>
          <option value="private-company">Entreprise privée</option>
          <option value="consulting">Cabinet de conseil</option>
          <option value="media">Média</option>
          <option value="individual">Particulier</option>
          <option value="other">Autre</option>
        </select>
      </div>
    </form>
    
    <div class="privacy-notice">
      <p><strong>Confidentialité :</strong> Ces informations sont stockées uniquement sur cet ordinateur et nous aident à améliorer le service. Vous pouvez les modifier ou les supprimer à tout moment via le panneau de profil.</p>
    </div>
    
    <div class="modal-actions">
      <button type="button" id="skip-profile" class="secondary-button">Passer</button>
      <button type="button" id="submit-profile" class="primary-button">Enregistrer</button>
    </div>
  </div>
</div>

<!-- Profile Panel -->
<aside class="hidden" id="profile-panel">
  <div id="profile-header">
    <button id="profile-close-btn">✖️</button>
    <h2>Mon Profil</h2>
  </div>
  
  <div class="settings-grid" id="profile-container">
    <div class="profile-info">
      <p>Profil spécifique à cet ordinateur</p>
    </div>
    
    <form id="profile-edit-form" class="settings-grid">
      <div class="form-group">
        <label class="form-label" for="edit-profile-name">Nom</label>
        <input type="text" id="edit-profile-name" class="form-input">
      </div>
      
      <div class="form-group">
        <label class="form-label" for="edit-profile-email">Email</label>
        <input type="email" id="edit-profile-email" class="form-input">
      </div>
      
      <div class="form-group">
        <label class="form-label" for="edit-profile-role">Rôle</label>
        <select id="edit-profile-role" class="form-select">
          <option value="">Sélectionnez votre rôle</option>
          <option value="researcher">Chercheur/Chercheuse</option>
          <option value="student">Étudiant(e)</option>
          <option value="policy-maker">Décideur politique</option>
          <option value="consultant">Consultant(e)</option>
          <option value="journalist">Journaliste</option>
          <option value="citizen">Citoyen(ne)</option>
          <option value="other">Autre</option>
        </select>
      </div>
      
      <div class="form-group">
        <label class="form-label" for="edit-profile-usage">Contexte d'utilisation</label>
        <select id="edit-profile-usage" class="form-select">
          <option value="">Sélectionnez le contexte</option>
          <option value="research">Recherche académique</option>
          <option value="education">Enseignement/Formation</option>
          <option value="policy">Élaboration de politiques</option>
          <option value="business">Conseil/Business</option>
          <option value="personal">Intérêt personnel</option>
          <option value="journalism">Journalisme</option>
          <option value="other">Autre</option>
        </select>
      </div>
      
      <div class="form-group">
        <label class="form-label" for="edit-profile-organization">Type d'organisation</label>
        <select id="edit-profile-organization" class="form-select">
          <option value="">Sélectionnez le type</option>
          <option value="university">Université/École</option>
          <option value="research-institute">Institut de recherche</option>
          <option value="government">Administration publique</option>
          <option value="ngo">ONG/Association</option>
          <option value="private-company">Entreprise privée</option>
          <option value="consulting">Cabinet de conseil</option>
          <option value="media">Média</option>
          <option value="individual">Particulier</option>
          <option value="other">Autre</option>
        </select>
      </div>
    </form>
    
    <div class="profile-actions">
      <button type="button" id="save-profile" class="primary-button">Sauvegarder</button>
      <button type="button" id="clear-profile" class="secondary-button">Effacer le profil</button>
    </div>
  </div>
</aside>


<script src="utils.js"></script>
<script src="profile.js"></script>
<script src="settings.js"></script>
<script src="config.js"></script>
<script src="messages.js"></script>
<script src="economics.js"></script>
<script src="citations.js"></script>
<script src="tooltips.js"></script>
<script src="api.js"></script>
</body>
</html>
