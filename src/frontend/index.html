<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Cirdi - Assistant documentaire scientifique du CIRED</title>
  <link rel="stylesheet" href="https://unpkg.com/purecss@3.0.0/build/pure-min.css">
  <link rel="stylesheet" href="https://unpkg.com/purecss@3.0.0/build/grids-responsive-min.css">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.5/dist/purify.min.js"></script>
  <link rel="stylesheet" href="main.css">
</head>

<body>

<header>
  <button id="config-btn">⚙️</button>
    <div id="input-container">
      <div id="input">
        <textarea
          id="user-input"
          placeholder="Cirdi, que disent les écrits du CIRED sur..."
          rows="2"
          ></textarea>
        <button id="send-btn">
          ➤
        </button>
      </div>
      <div id="input-help">
        <p>Cirdi parle français et + de 100 langues: Cirdi speaks English – Hablo español – Я говорю по-русски – 我会说中文 – أنا أتكلم العربية.</p>
        <p>Appuyez sur Entrée pour envoyer, Maj+Entrée pour une nouvelle ligne.</p>
      </div>
    </div> <!-- id="input-container" -->
</header>

<main id="messages-container">
  <div>
    <div id="greeting">
      Bonjour !<br /><br />
      Je suis <strong>Cirdi</strong>, votre documentaliste scientifique. Je dispose des travaux du Centre International de Recherche sur l'Environnement et le Développement (CIRED) sur les thèmes ci dessous. Je vais les analyser afin de vous proposer une synthèse avec liens directs en accès libre sur HAL pour en savoir plus 😉.<br />
      <div id="legend">
        <strong>Domaines d'expertise</strong> : Cirdi a indexé 1199 publications du CIRED
      </div>
      <img
        alt="Nuage de mots représentant les principales thématiques de recherche CIRED : changement climatique, transition énergétique, politique climatique, modélisation économique, énergies renouvelables, développement durable, et politiques environnementales"
        src="static/cired_wordcloud.png"
      />
    </div> <!-- id="greeting" -->
  </div> <!-- id="messages-container" -->
</main>

<footer>
    ⚠️ <strong>Les conversations sont enregistrées pour améliorer le service.</strong>
    Vous pourrez donner un feedback en cliquant 👍 ou 👎 sous la réponse.<br />
    📊 <a href="#" id="view-analytics-link">Voir les données collectées</a> |
    🔒 <a href="#" id="privacy-policy-link">Politique de confidentialité</a>
</footer>


<!-- Aide button (initially hidden) -->
<button id="aide-btn" class="hidden">Aide</button>

<!-- Mode d'emploi Modal -->
<aside id="mode-emploi-panel">
  <div id="mode-emploi-header">
    <button id="mode-emploi-close-btn">✖️</button>
    <h2>Mode d'emploi</h2>
  </div>
  <div id="mode-emploi-content">
    <section>
      <h3>Comment utiliser (comme un moteur de recherche : tapez dans la boîte puis Entrée)</h3>
      
      <h4>Exemples de questions :</h4>
      <ul>
        <li><strong>"Quelle est la production alimentaire agricole par habitant en Andhra Prades actuellement ?"</strong> illustre la récupération précise de faits avec orthographe approximative (Pradesh manque le h final). Utile pour l'écriture et la recherche, avec une probabilité plus faible.</li>
        <li><strong>"Le CCS"</strong></li>
        <li>Une question en portugais pour illustrer les capacités multilingues.</li>
        <li><strong>"Pourquoi l'échec de Kyoto?"</strong> illustre la conscience du contexte et la spécificité du point de vue CIRED.</li>
        <li><strong>"Comment préparer ma présentation?"</strong> il y a quelques manuels de méthodes de recherche dans HAL</li>
        <li><strong>"Traduit: « De los diversos instrumentos inventados por el hombre, el más asombroso es el libro; todos los demás son extensiones de su cuerpo. Sólo el libro es una extensión de la imaginación y la memoria. » (Borges, 1978)"</strong> c'est un LLM</li>
        <li><strong>"Who is Ignacy Sachs?"</strong> Vous pouvez obtenir la courte biographie des auteurs.</li>
      </ul>
    </section>

    <section>
      <h3>Comment ça marche</h3>
      <p>Une explication de style bande dessinée, avec Cirdi personnalisé comme assistant :</p>
      
      <div class="comic-explanation">
        <div class="comic-step">
          <strong>📚 Intake :</strong> lire le corpus, diviser en segments de taille paragraphe et indexer les segments. Cirdi organisant les archives avant d'ouvrir boutique.
        </div>
        
        <div class="comic-step">
          <strong>🤔 Cirdi recevant une demande d'un visiteur.</strong>
        </div>
        
        <div class="comic-step">
          <strong>🔍 Retrieve :</strong> trouver les segments les plus pertinents pour la question. Cirdi dans les archives, trouvant des papiers dans des boîtes.
        </div>
        
        <div class="comic-step">
          <strong>✍️ Generate :</strong> Demander à un LLM de répondre à la question avec les segments pertinents. Cirdi donnant la pile de papiers à un écrivain. Cirdi récupérant la réponse.
        </div>
        
        <div class="comic-step">
          <strong>📝 Reformat :</strong> présenter comme un texte académique. Cirdi à son bureau, réécrivant la réponse. Cirdi la retournant à l'utilisateur.
        </div>
      </div>
    </section>

    <section>
      <h3>Limites du corpus</h3>
      <ul>
        <li>De nombreuses publications CIRED ne sont pas archivées en accès libre dans HAL (et Cirdi n'a pas cherché ailleurs pour le texte intégral).</li>
        <li>La plupart des anciennes publications CiRED ne sont pas dans Hal (encore ?)</li>
        <li>Quelques publications ne sont pas ingérées pour des raisons techniques (environ 1% de fichiers surdimensionnés)</li>
        <li>Hal archive la production scientifique, pas la communication institutionnelle (par exemple, utilisez le site web CIRED → <a href="https://www.centre-cired.fr" target="_blank">https://www.centre-cired.fr</a> pour connaître la recherche en cours, abonnez-vous à la newsletter pour connaître les événements actuels → <a href="https://tinyurl.com/z4sr8p6z" target="_blank">https://tinyurl.com/z4sr8p6z</a>).</li>
      </ul>
    </section>

    <section>
      <h3>Limites du système</h3>
      <ul>
        <li>Le LLM peut encore halluciner (Attention aux déclarations attribuées à des sources non trouvées.)</li>
        <li>Pas conversationnel (Cirdi ne se souvient pas des questions précédentes)</li>
        <li>Pas agentique (Cirdi ne stratégisera pas un plan en plusieurs étapes qui utilise des outils en ligne pour répondre à la question)</li>
        <li>En particulier, Cirdi ne recherche pas dans toute la littérature scientifique ou autre chose (il existe de nombreux outils pour la revue générale de littérature → <a href="https://www.google.com/search?q=Tools+conduct+scientific+literature+review" target="_blank">https://www.google.com/search?q=Tools+conduct+scientific+literature+review</a>)</li>
        <li>Pas persistant (Coupez et collez la réponse ailleurs avant de fermer la session.)</li>
        <li>La récolte de HAL est à la demande, pas périodique.</li>
      </ul>
    </section>
  </div>
</aside>

<!-- Configuration Panel -->
<aside class="hidden" id="config-panel"></aside>

  <div id="config-header">
    <button id="config-close-btn">✖️</button>
    <h2>Cirdi settings</h2>
  </div>

  <div class="settings-grid" id="settings-container">

    <div class="form-group">
      <div class="label-with-status">
        <label class="form-label">
          Server URL
          <span class="help-icon" title="Where to find the R2R API endpoint. Try http://cired.digital:7272">ℹ️</span>
        </label>
        <div class="status-text" id="api-status">Status: OK</div>
      </div>
      <input class="form-input" id="api-url" type="text"/>
    </div>

    <div class="form-group">
      <label class="form-label">
      Language model
      <span class="help-icon" title="The LLM used to generate replies. Commercial options disabled for cost control.">ℹ️</span>
      </label>
      <select class="form-select" id="model">
        <option>Chargement...</option>
      </select>
      <div id="model-info">
        Tariff: input <span id="input-tariff">...</span>&nbsp;$, output <span id="output-tariff">...</span>&nbsp;$ per 1M tokens
      </div>
    </div>

    <div class="form-group">
      <label class="form-label">
        Temperature (response creativity)
        <span class="help-icon" title="Automatically set to model provider's recommendations.">ℹ️</span>
      </label>
      <input type="number" id="temperature" class="form-input" step="0.05"/>
    </div>

    <div class="form-group">
      <label class="form-label">
        Max tokens (response length)
        <span class="help-icon" title="Automatically set according to the model.">ℹ️</span>
      </label>
      <input type="number" id="max-tokens" class="form-input" step="100"/>
    </div>

    <div class="form-group">
      <label class="form-label">
        Nombre maximum de segments à récupérer
        <span class="help-icon" title="Entre 1 et 1000.">ℹ️</span>
      </label>
      <input type="number" id="chunk-limit" class="form-input" step="1"/>
    </div>

    <div class="form-group">
      <label class="form-label">
        Méthode pour pêcher les segments
        <span class="help-icon" title="Options: vanilla (recherche directe rapide - pour question précise), rag_fusion (reformule - pour question ambigüe), HyDE (prêche le faux pour pêcher le vrai - pour question ouverte, conceptuelle)">ℹ️</span>
      </label>
      <select id="search-strategy" class="form-select">
        <option value="vanilla">Vanilla</option>
        <option value="rag_fusion">RAG Fusion</option>
        <option value="hyde" selected>Hyde</option>
      </select>
    </div>

    <div class="checkbox-container web-search-container">
      <label class="checkbox-label">
        <input type="checkbox" id="include-web-search" class="checkbox-input"  disabled>
        <span class="web-search-text"><strong>Recherche Web</strong> – Inclure les résultats web (0.1 cent par question)</span>
      </label>
    </div>

    <div class="checkbox-container privacy-container">
      <label class="checkbox-label">
        <input type="checkbox" id="privacy-mode" class="checkbox-input">
        <span class="privacy-text"><strong>Privacy Mode</strong> – No logging</span>
      </label>
      <div class="form-group">
        <div class="label-with-status">
          <label class="form-label" for="feedback-url">URL du backend de journalisation</label>
          <div class="status-text" id="feedback-status">Chargement…</div>
        </div>
        <input class="form-input" id="feedback-url" type="text" readonly/>
      </div>
    </div>

    <div class="checkbox-container debug-container">
      <label class="checkbox-label">
        <input type="checkbox" id="debug-mode" class="checkbox-input">
        <span class="debug-text"><strong>Debug Mode</strong> – Show response logs in console</span>
      </label>
    </div>

  </div> <!-- id="settings-container"-->
</aside>


<script src="utils.js"></script>
<script src="settings.js"></script>
<script src="config.js"></script>
<script src="messages.js"></script>
<script src="economics.js"></script>
<script src="citations.js"></script>
<script src="tooltips.js"></script>
<script src="api.js"></script>
</body>
</html>
